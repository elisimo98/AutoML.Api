@page "/"
@using System.Security.Claims
@using AutoML.Web.Data.Interfaces
@using AutoML.Web.Interfaces
@using AutoML.Web.Models
@using AutoML.Web.Models.Data
@using AutoML.Web.Services
@inject IUserService UserService
@inject IProjectService ProjectService
@inject NavigationManager Navigation
@inject SessionService SessionService

<PageTitle>Dashboard</PageTitle>

<MudText Typo="Typo.h4" GutterBottom="true">Dashboard</MudText>
<MudText Typo="Typo.subtitle2" Class="mb-4">Overview of your machine learning models and deployments</MudText>

<!-- Metric Cards -->
<MudGrid>
    <MudItem xs="12" sm="6" md="3">
        <MudPaper Class="p-4 d-flex flex-column card-border" Elevation="0" Height="100%">
            <MudText Typo="Typo.subtitle2">Active Models</MudText>
            <MudText Typo="Typo.h5" Class="fw-bold">2</MudText>
            <MudText Typo="Typo.caption">Currently deployed and running</MudText>
            <MudText Typo="Typo.caption" Color="Color.Success">+12% from last month</MudText>
        </MudPaper>
    </MudItem>

    <MudItem xs="12" sm="6" md="3">
        <MudPaper Class="p-4 d-flex flex-column card-border" Elevation="0" Height="100%">
            <MudText Typo="Typo.subtitle2">Total Deployments</MudText>
            <MudText Typo="Typo.h5" Class="fw-bold">2</MudText>
            <MudText Typo="Typo.caption">of 50 allowed</MudText>
        </MudPaper>
    </MudItem>

    <MudItem xs="12" sm="6" md="3">
        <MudPaper Class="p-4 d-flex flex-column card-border" Elevation="0" Height="100%">
            <MudText Typo="Typo.subtitle2">Api Requests</MudText>
            <MudText Typo="Typo.h5" Class="fw-bold">2,139</MudText>
            <MudText Typo="Typo.caption">Last 24 hours</MudText>
            <MudText Typo="Typo.caption" Color="Color.Success">+8% from last month</MudText>
        </MudPaper>
    </MudItem>

    <MudItem xs="12" sm="6" md="3">
        <MudPaper Class="p-4 d-flex flex-column card-border" Elevation="0" Height="100%">
            <MudText Typo="Typo.subtitle2">Success Rate</MudText>
            <MudText Typo="Typo.h5" Class="fw-bold">94.3%</MudText>
            <MudText Typo="Typo.caption">Model inference accuracy</MudText>
            <MudText Typo="Typo.caption" Color="Color.Success">+0.5% from last month</MudText>
        </MudPaper>
    </MudItem>
</MudGrid>

<MudGrid Class="mt-3">
    <!-- Resource Usage -->
    <MudItem xs="12" md="6">
        <MudPaper Class="p-4 card-border" Elevation="0" Height="100%">
            <MudText Typo="Typo.h6">Resource Usage</MudText>
            <MudText Typo="Typo.caption">Current deployment limits and usage</MudText>

            <!-- Deployments -->
            <MudText Class="mt-4">Deployments</MudText>
            <MudProgressLinear Size="Size.Medium" Value="40" Color="Color.Primary" />
            <MudText Typo="Typo.caption">4 / 10</MudText>

            <!-- Models -->
            <MudText Class="mt-4">Models</MudText>
            <MudProgressLinear Size="Size.Medium" Value="20" Color="Color.Primary" />
            <MudText Typo="Typo.caption">8 / 50</MudText>
        </MudPaper>
    </MudItem>

    <!-- Recent Activity -->
    <MudItem xs="12" md="6">
        <MudPaper Class="p-4 card-border" Elevation="0" Height="100%">
            <MudText Typo="Typo.h6">Recent Activity</MudText>
            <MudText Typo="Typo.caption">Latest model deployments and updates</MudText>

            <MudText Class="mt-4">Customer Churn Predictor v2.1.0 deployed successfully</MudText>

        </MudPaper>
    </MudItem>
</MudGrid>

<MudGrid Class="mt-3">
    <!-- Model Deployments -->
    <MudItem xs="12" md="12" sm="12">
        <MudPaper Class="p-4 card-border" Elevation="0" MinHeight="500px">
            <MudText Typo="Typo.h6">Model Deployments</MudText>
            <MudText Typo="Typo.caption" Class="mb-4">Status of all deployed models</MudText>

            <MudPaper Class="p-2 mt-4 card-border" Elevation="0">
                <MudText Typo="Typo.subtitle1">Example model</MudText>
                <MudText Typo="Typo.caption">https://api.acme.com/churn/predict</MudText>
            </MudPaper>
        </MudPaper>
    </MudItem>

</MudGrid>

@code {
    private UserViewModel? user;
    private List<Project>? projects;

    protected override async Task OnInitializedAsync()
    {
        // user = await UserService.GetCurrentUserAsync();
        // if (user != null)
        // {
        //     projects = await ProjectService.GetProjectByUserIdAsync(user.Id);
        // }

        Navigation.NavigateTo($"/model-configuration");

        //projects = await ProjectService.GetProjectByUserIdAsync("e47b2121-0ae5-48d9-ac55-a3ac447d8462");
    }

    private async Task OpenProjectAsync(Project project)
    {
        await SessionService.SetProjectIdAsync(project.Id.ToString());
        await SessionService.SetProjectNameAsync(project.Name);
        Navigation.NavigateTo($"/project/configure/{project.Id}");
    }
}